{"openapi":"3.1.0","info":{"title":"Bank Cards API","description":"REST API for managing users, cards and authentication in the BankCards service","license":{"name":"Apache 2.0","url":"http://springdoc.org"},"version":"v1.0"},"servers":[{"url":"http://localhost:8080","description":"Generated server url"}],"security":[{"bearerAuth":[]}],"tags":[{"name":"Admin Cards","description":"Ручки для администратора"},{"name":"User Cards","description":"Операции пользователя с собственными картами"},{"name":"Authentication","description":"Регистрация, вход и выход пользователей"},{"name":"Token refresh","description":"Обновление access токена с помощью refresh токена (HttpOnly cookie)"}],"paths":{"/admin/cards/{id}":{"put":{"tags":["Admin Cards"],"summary":"Обновить карту","description":"Обновляет существующую карту по её ID","operationId":"update","parameters":[{"name":"id","in":"path","required":true,"schema":{"type":"integer","format":"int64","minimum":1}}],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UpdateCardRequest"}}},"required":true},"responses":{"200":{"description":"Карта обновлена","content":{"*/*":{"schema":{"$ref":"#/components/schemas/UpdateCardResponse"}}}},"400":{"description":"Некорректные данные","content":{"*/*":{"schema":{"$ref":"#/components/schemas/UpdateCardResponse"}}}},"404":{"description":"Карта не найдена","content":{"*/*":{"schema":{"$ref":"#/components/schemas/UpdateCardResponse"}}}},"500":{"description":"Внутренняя ошибка сервера","content":{"*/*":{"schema":{"$ref":"#/components/schemas/UpdateCardResponse"}}}}}},"delete":{"tags":["Admin Cards"],"summary":"Удалить карту","description":"Удаляет карту по её ID","operationId":"delete","parameters":[{"name":"id","in":"path","description":"Card ID","required":true,"schema":{"type":"integer","format":"int64","minimum":1},"example":1}],"responses":{"204":{"description":"Карта удалена"},"404":{"description":"Карта не найдена"},"500":{"description":"Внутренняя ошибка сервера"}}}},"/user/cards/{cardId}/block-request":{"post":{"tags":["User Cards"],"summary":"Запрос на блокировку карты","description":"Отправляет запрос на блокировку карты (например, при утере).\nЗапрос принимается асинхронно (HTTP 202 Accepted).\n","operationId":"createCardBlockRequest","parameters":[{"name":"cardId","in":"path","description":"ID карты","required":true,"schema":{"type":"integer","format":"int64","minimum":1},"example":150}],"requestBody":{"description":"Причина блокировки карты","content":{"application/json":{"schema":{"$ref":"#/components/schemas/CardBlockRequest"}}},"required":true},"responses":{"202":{"description":"Запрос на блокировку принят","content":{"*/*":{"schema":{"$ref":"#/components/schemas/CardBlockResponse"}}}},"404":{"description":"Карта не найдена или не принадлежит пользователю","content":{"*/*":{"schema":{"$ref":"#/components/schemas/CardBlockResponse"}}}},"401":{"description":"Пользователь не авторизован","content":{"*/*":{"schema":{"$ref":"#/components/schemas/CardBlockResponse"}}}},"500":{"description":"Внутренняя ошибка сервера","content":{"*/*":{"schema":{"$ref":"#/components/schemas/CardBlockResponse"}}}}}}},"/user/cards/transfer":{"post":{"tags":["User Cards"],"summary":"Перевод между своими картами","description":"Выполняет перевод средств между двумя картами пользователя.\nПоддерживает идемпотентность (повторный запрос с тем же ключом может вернуть 409).\n","operationId":"transferBetweenMyCards","requestBody":{"description":"Данные для перевода между картами (ID источника, ID получателя, сумма)","content":{"application/json":{"schema":{"$ref":"#/components/schemas/TransferBetweenMyCardsRequest"}}},"required":true},"responses":{"200":{"description":"Перевод успешно выполнен","content":{"*/*":{"schema":{"$ref":"#/components/schemas/TransferBetweenMyCardsResponse"}}}},"400":{"description":"Ошибка валидации или одинаковая карта-отправитель/получатель","content":{"*/*":{"schema":{"$ref":"#/components/schemas/TransferBetweenMyCardsResponse"}}}},"403":{"description":"Карта не принадлежит пользователю","content":{"*/*":{"schema":{"$ref":"#/components/schemas/TransferBetweenMyCardsResponse"}}}},"409":{"description":"Конфликт идемпотентности или параллельного перевода","content":{"*/*":{"schema":{"$ref":"#/components/schemas/TransferBetweenMyCardsResponse"}}}},"401":{"description":"Пользователь не авторизован","content":{"*/*":{"schema":{"$ref":"#/components/schemas/TransferBetweenMyCardsResponse"}}}},"500":{"description":"Внутренняя ошибка сервера","content":{"*/*":{"schema":{"$ref":"#/components/schemas/TransferBetweenMyCardsResponse"}}}}}}},"/auth/register":{"post":{"tags":["Authentication"],"summary":"Регистрация нового пользователя","operationId":"register","requestBody":{"description":"Данные для регистрации нового пользователя","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RegisterRequest"}}},"required":true},"responses":{"200":{"description":"Успешная регистрация","content":{"*/*":{"schema":{"$ref":"#/components/schemas/RegisterResponse"}}}},"400":{"description":"Некорректные данные запроса","content":{"*/*":{"schema":{"$ref":"#/components/schemas/ApiErrorResponse"}}}},"409":{"description":"Пользователь с таким логином или email уже существует","content":{"*/*":{"schema":{"$ref":"#/components/schemas/ApiErrorResponse"}}}},"500":{"description":"Внутренняя ошибка сервера","content":{"*/*":{"schema":{"$ref":"#/components/schemas/ApiErrorResponse"}}}}}}},"/auth/logout":{"post":{"tags":["Authentication"],"summary":"Выход пользователя","description":"Инвалидирует refresh token и очищает cookie.\nAccess token после выхода становится бесполезным (при следующем refresh будет ошибка).\n","operationId":"logout","parameters":[{"name":"Authorization","in":"header","required":false,"schema":{"type":"string"}},{"name":"refreshToken","in":"cookie","required":false,"schema":{"type":"string"}}],"responses":{"200":{"description":"Успешный выход (cookie очищено)"},"401":{"description":"Пользователь не авторизован"},"500":{"description":"Внутренняя ошибка сервера"}},"security":[{"bearerAuth":[]}]}},"/auth/login":{"post":{"tags":["Authentication"],"summary":"Аутентификация пользователя","description":"Выполняет вход по username и паролю.\nВозвращает access token в теле ответа.\nRefresh token устанавливается в HttpOnly cookie.\n","operationId":"login","requestBody":{"description":"Данные для входа (логин и пароль)","content":{"application/json":{"schema":{"$ref":"#/components/schemas/LoginRequest"}}},"required":true},"responses":{"200":{"description":"Успешный вход","content":{"*/*":{"schema":{"$ref":"#/components/schemas/LoginResponse"}}}},"401":{"description":"Неверные учетные данные","content":{"*/*":{"schema":{"$ref":"#/components/schemas/LoginResponse"}}}},"500":{"description":"Внутренняя ошибка сервера","content":{"*/*":{"schema":{"$ref":"#/components/schemas/LoginResponse"}}}}}}},"/auth/jwt/refresh":{"post":{"tags":["Token refresh"],"summary":"Обновить access токен","description":"Обновляет access токен, используя refresh токен из HttpOnly cookie.\nВозвращает новый access токен в теле ответа, а refresh токен автоматически\nобновляется и отправляется обратно в cookie.\n","operationId":"refreshToken","responses":{"200":{"description":"Новый access токен выдан","content":{"*/*":{"schema":{"$ref":"#/components/schemas/RefreshedAccessToken"}}}},"401":{"description":"Refresh токен отсутствует, недействителен или истёк","content":{"*/*":{"schema":{"$ref":"#/components/schemas/RefreshedAccessToken"}}}},"500":{"description":"Внутренняя ошибка сервера","content":{"*/*":{"schema":{"$ref":"#/components/schemas/RefreshedAccessToken"}}}}}}},"/admin/cards":{"get":{"tags":["Admin Cards"],"summary":"Получить список карт","description":"Возвращает страницу карт с возможностью фильтрации и пагинации","operationId":"getAllCards","parameters":[{"name":"status","in":"query","description":"Фильтр по статусу карты (ACTIVE, BLOCKED, EXPIRED)","required":false,"schema":{"type":"string","description":"Фильтр по статусу карты (ACTIVE, BLOCKED, EXPIRED)","enum":["ACTIVE","BLOCKED","EXPIRED"],"example":"ACTIVE"},"example":"ACTIVE"},{"name":"type","in":"query","description":"Фильтр по типу карты (DEBIT, CREDIT, VIRTUAL)","required":false,"schema":{"type":"string","description":"Фильтр по типу карты (DEBIT, CREDIT, VIRTUAL)","enum":["VISA","MASTERCARD","AMEX","BANK_SPECIFIC"],"example":"DEBIT"},"example":"DEBIT"},{"name":"expirationBefore","in":"query","description":"Найти карты с датой истечения раньше указанной","required":false,"schema":{"type":"string","format":"date","description":"Найти карты с датой истечения раньше указанной","example":"2027-01-01"},"example":"2027-01-01"},{"name":"expirationAfter","in":"query","description":"Найти карты с датой истечения позже указанной","required":false,"schema":{"type":"string","format":"date","description":"Найти карты с датой истечения позже указанной","example":"2024-12-31"},"example":"2024-12-31"},{"name":"page","in":"query","description":"Zero-based page index (0..N)","required":false,"schema":{"type":"integer","default":0,"minimum":0}},{"name":"size","in":"query","description":"The size of the page to be returned","required":false,"schema":{"type":"integer","default":20,"minimum":1}},{"name":"sort","in":"query","description":"Sorting criteria in the format: property,(asc|desc). Default sort order is ascending. Multiple sort criteria are supported.","required":false,"schema":{"type":"array","items":{"type":"string"}}}],"responses":{"200":{"description":"Список карт получен","content":{"*/*":{"schema":{"$ref":"#/components/schemas/CardDto"}}}},"400":{"description":"Некорректные параметры фильтра/пагинации","content":{"*/*":{"schema":{"$ref":"#/components/schemas/PageCardDto"}}}},"500":{"description":"Внутренняя ошибка сервера","content":{"*/*":{"schema":{"$ref":"#/components/schemas/PageCardDto"}}}}}},"post":{"tags":["Admin Cards"],"summary":"Создать новую карту","description":"Создает новую карту на основе входных данных","operationId":"create","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateCardRequest"}}},"required":true},"responses":{"201":{"description":"Карта успешно создана","content":{"*/*":{"schema":{"$ref":"#/components/schemas/CreateCardResponse"}}}},"400":{"description":"Некорректные данные запроса","content":{"*/*":{"schema":{"$ref":"#/components/schemas/CreateCardResponse"}}}},"409":{"description":"Карта с таким номером уже существует","content":{"*/*":{"schema":{"$ref":"#/components/schemas/CreateCardResponse"}}}},"500":{"description":"Внутренняя ошибка сервера","content":{"*/*":{"schema":{"$ref":"#/components/schemas/CreateCardResponse"}}}}}}},"/admin/cards/{id}/status/{status}":{"patch":{"tags":["Admin Cards"],"summary":"Изменить статус карты","description":"Меняет статус карты (например: ACTIVE, BLOCKED, EXPIRED)","operationId":"setCardStatus","parameters":[{"name":"id","in":"path","description":"Card ID","required":true,"schema":{"type":"integer","format":"int64","minimum":1},"example":1},{"name":"status","in":"path","description":"Card status","required":true,"schema":{"type":"string","enum":["ACTIVE","BLOCKED","EXPIRED"]}}],"responses":{"200":{"description":"Статус карты изменен","content":{"*/*":{"schema":{"$ref":"#/components/schemas/SetCardStatusResponse"}}}},"400":{"description":"Некорректный статус","content":{"*/*":{"schema":{"$ref":"#/components/schemas/SetCardStatusResponse"}}}},"404":{"description":"Карта не найдена","content":{"*/*":{"schema":{"$ref":"#/components/schemas/SetCardStatusResponse"}}}}}}},"/user/cards":{"get":{"tags":["User Cards"],"summary":"Список карт пользователя","description":"Возвращает все карты, принадлежащие текущему пользователю (по principal), с поддержкой пагинации.","operationId":"listCards","parameters":[{"name":"pageable","in":"query","required":true,"schema":{"$ref":"#/components/schemas/Pageable"}}],"responses":{"200":{"description":"Карты успешно получены","content":{"*/*":{"schema":{"$ref":"#/components/schemas/CardDto"}}}},"401":{"description":"Пользователь не авторизован","content":{"*/*":{"schema":{"$ref":"#/components/schemas/PageCardDto"}}}},"500":{"description":"Внутренняя ошибка сервера","content":{"*/*":{"schema":{"$ref":"#/components/schemas/PageCardDto"}}}}}}},"/user/cards/{cardId}/balance":{"get":{"tags":["User Cards"],"summary":"Получить баланс карты","description":"Возвращает текущий баланс указанной карты, если она принадлежит пользователю.","operationId":"getMyCardBalance","parameters":[{"name":"cardId","in":"path","description":"ID карты","required":true,"schema":{"type":"integer","format":"int64","minimum":1},"example":100}],"responses":{"200":{"description":"Баланс успешно получен","content":{"*/*":{"schema":{"$ref":"#/components/schemas/BalanceResponse"}}}},"404":{"description":"Карта не найдена или не принадлежит пользователю","content":{"*/*":{"schema":{"$ref":"#/components/schemas/BalanceResponse"}}}},"401":{"description":"Пользователь не авторизован","content":{"*/*":{"schema":{"$ref":"#/components/schemas/BalanceResponse"}}}},"500":{"description":"Внутренняя ошибка сервера","content":{"*/*":{"schema":{"$ref":"#/components/schemas/BalanceResponse"}}}}}}}},"components":{"schemas":{"UpdateCardResponse":{"type":"object","description":"Ответ после обновления карты","properties":{"cardId":{"type":"integer","format":"int64","description":"ID карты","example":1001},"number":{"type":"string","description":"Номер карты (может быть замаскирован)","example":"555566******8888"},"expiration":{"type":"string","format":"date","description":"Дата истечения срока действия","example":"2031-05-20"},"status":{"type":"string","description":"Текущий статус карты","enum":["ACTIVE","BLOCKED","EXPIRED"],"example":"ACTIVE"},"balance":{"type":"number","description":"Текущий баланс карты","example":2000.0}}},"UpdateCardRequest":{"type":"object","description":"Запрос на обновление существующей карты","properties":{"cardId":{"type":"integer","format":"int64","description":"ID обновляемой карты","example":1001},"number":{"type":"string","description":"Новый номер карты (12–19 цифр)","example":5555666677778888,"maxLength":19,"minLength":12},"expiration":{"type":"string","format":"date","description":"Новая дата истечения срока действия карты","example":"2031-05-20"},"balance":{"type":"number","description":"Обновленный баланс карты","example":2000.0,"minimum":0.00}},"required":["cardId"]},"CardBlockResponse":{"type":"object","description":"Ответ после запроса на блокировку карты","properties":{"cardId":{"type":"integer","format":"int64","description":"ID карты","example":101},"message":{"type":"string","description":"Сообщение о результате операции","example":"Запрос на блокировку успешно принят"}}},"CardBlockRequest":{"type":"object","description":"Запрос на блокировку карты","properties":{"reason":{"type":"string","description":"Причина блокировки карты","example":"Карта утеряна","minLength":1}}},"TransferBetweenMyCardsResponse":{"type":"object","description":"Ответ после перевода между картами пользователя","properties":{"fromCardId":{"type":"integer","format":"int64","description":"ID карты-отправителя","example":101},"toCardId":{"type":"integer","format":"int64","description":"ID карты-получателя","example":102},"amount":{"type":"number","description":"Сумма перевода","example":500.0},"status":{"type":"string","description":"Статус перевода","example":"SUCCESS"}}},"TransferBetweenMyCardsRequest":{"type":"object","description":"Запрос на перевод средств между картами одного пользователя","properties":{"fromCardId":{"type":"integer","format":"int64","description":"ID карты-отправителя","example":101,"minimum":1},"toCardId":{"type":"integer","format":"int64","description":"ID карты-получателя","example":102,"minimum":1},"amount":{"type":"number","description":"Сумма перевода","example":500.0,"minimum":0.00}},"required":["amount","fromCardId","toCardId"]},"RegisterResponse":{"type":"object","description":"Ответ после успешной регистрации пользователя","properties":{"accessToken":{"type":"string","description":"JWT Access token. Используется в заголовке Authorization: Bearer <token> для доступа к защищённым ресурсам. Обычно живёт 10–30 минут.","example":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."}}},"ApiErrorResponse":{"type":"object","description":"Стандартный ответ об ошибке","properties":{"error":{"type":"string","description":"Краткое название ошибки","example":"Bad Request"},"message":{"type":"string","description":"Подробное сообщение об ошибке","example":"Card with id 999 not found"},"status":{"type":"integer","format":"int32","description":"HTTP статус-код","example":404},"timestamp":{"type":"string","format":"date-time","description":"Время возникновения ошибки","example":"2025-09-12T14:23:45"}}},"RegisterRequest":{"type":"object","description":"Запрос на регистрацию нового пользователя","properties":{"username":{"type":"string","description":"Уникальный логин пользователя. Должен содержать от 4 до 30 символов.","example":"barahlyush","maxLength":30,"minLength":4},"password":{"type":"string","description":"Пароль пользователя. Минимум 6, максимум 72 символа. В продакшн-регистрации часто применяют правила сложности (буквы, цифры, спецсимволы).","example":"Str0ngP@ssw0rd!","maxLength":72,"minLength":6,"pattern":"^(?=.*[A-Za-z])(?=.*\\d)(?=.*[@$!%*#?^&])[A-Za-z\\d@$!%*#?^&]{8,32}$"},"email":{"type":"string","description":"Email пользователя. Используется для подтверждения и восстановления доступа.","example":"user@example.com","minLength":1},"name":{"type":"string","description":"Имя пользователя (реальное или отображаемое).","example":"Иван","maxLength":50,"minLength":1},"surname":{"type":"string","description":"Фамилия пользователя.","example":"Иванов","maxLength":50,"minLength":1},"birthDate":{"type":"string","format":"date","description":"Дата рождения (должна быть в прошлом). Может использоваться для проверки возраста.","example":"1995-08-15"}},"required":["birthDate"]},"LoginResponse":{"type":"object","description":"Ответ после успешной аутентификации (только Access token)","properties":{"accessToken":{"type":"string","description":"JWT Access token. Используется в заголовке Authorization: Bearer <token> для доступа к защищённым ресурсам. Срок жизни обычно короткий (например, 15 минут).","example":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."}}},"LoginRequest":{"type":"object","description":"Запрос на аутентификацию с помощью логина и пароля","properties":{"username":{"type":"string","description":"Уникальный логин пользователя","example":"barahlyush","maxLength":30,"minLength":4},"password":{"type":"string","description":"Пароль для входа в систему","example":"P@ssw0rd2025!","maxLength":32,"minLength":8,"pattern":"^(?=.*[A-Za-z])(?=.*\\d)(?=.*[@$!%*#?^&])[A-Za-z\\d@$!%*#?^&]{8,32}$"}}},"RefreshedAccessToken":{"type":"object","properties":{"accessToken":{"type":"string"}}},"CreateCardResponse":{"type":"object","description":"Ответ после успешного создания банковской карты","properties":{"id":{"type":"integer","format":"int64","description":"Уникальный идентификатор созданной карты","example":5001},"successful":{"type":"boolean","description":"Флаг успешности операции","example":true},"status":{"type":"string","description":"Текущий статус карты (например, ACTIVE, BLOCKED, EXPIRED)","enum":["ACTIVE","BLOCKED","EXPIRED"],"example":"ACTIVE"}}},"CreateCardRequest":{"type":"object","description":"Запрос на создание новой банковской карты","properties":{"type":{"type":"string","description":"Тип карты","enum":["VISA","MASTERCARD","AMEX","BANK_SPECIFIC"],"example":"CREDIT"},"ownerId":{"type":"integer","format":"int64","description":"Идентификатор владельца карты (пользователь в системе).","example":1001}},"required":["ownerId","type"]},"SetCardStatusResponse":{"type":"object","description":"Ответ после изменения статуса карты","properties":{"cardId":{"type":"integer","format":"int64","description":"ID карты","example":123},"oldStatus":{"type":"string","description":"Старый статус карты","enum":["ACTIVE","BLOCKED","EXPIRED"],"example":"ACTIVE"},"newStatus":{"type":"string","description":"Новый статус карты","enum":["ACTIVE","BLOCKED","EXPIRED"],"example":"BLOCKED"}}},"CardDto":{"type":"object","description":"Банковская карта","properties":{"id":{"type":"integer","format":"int64","description":"Уникальный идентификатор карты","example":1001},"type":{"type":"string","description":"Тип карты","enum":["VISA","MASTERCARD","AMEX","BANK_SPECIFIC"],"example":"CREDIT"},"number":{"type":"string","description":"Номер карты (может быть замаскирован)","example":"411111******1111"},"expiration":{"type":"string","format":"date","description":"Дата истечения срока действия карты","example":"2030-12-31"},"status":{"type":"string","description":"Текущий статус карты (ACTIVE, BLOCKED, EXPIRED)","enum":["ACTIVE","BLOCKED","EXPIRED"],"example":"ACTIVE"},"balance":{"type":"number","description":"Баланс карты","example":2500.75}}},"Pageable":{"type":"object","properties":{"page":{"type":"integer","format":"int32","minimum":0},"size":{"type":"integer","format":"int32","minimum":1},"sort":{"type":"array","items":{"type":"string"}}}},"PageCardDto":{"type":"object","properties":{"totalElements":{"type":"integer","format":"int64"},"totalPages":{"type":"integer","format":"int32"},"pageable":{"$ref":"#/components/schemas/PageableObject"},"size":{"type":"integer","format":"int32"},"content":{"type":"array","items":{"$ref":"#/components/schemas/CardDto"}},"number":{"type":"integer","format":"int32"},"sort":{"$ref":"#/components/schemas/SortObject"},"first":{"type":"boolean"},"last":{"type":"boolean"},"numberOfElements":{"type":"integer","format":"int32"},"empty":{"type":"boolean"}}},"PageableObject":{"type":"object","properties":{"paged":{"type":"boolean"},"pageNumber":{"type":"integer","format":"int32"},"pageSize":{"type":"integer","format":"int32"},"offset":{"type":"integer","format":"int64"},"sort":{"$ref":"#/components/schemas/SortObject"},"unpaged":{"type":"boolean"}}},"SortObject":{"type":"object","properties":{"sorted":{"type":"boolean"},"empty":{"type":"boolean"},"unsorted":{"type":"boolean"}}},"BalanceResponse":{"type":"object","description":"Ответ с балансом карты","properties":{"cardId":{"type":"integer","format":"int64","description":"ID карты","example":101},"balance":{"type":"number","description":"Текущий баланс карты","example":1250.75}}}},"securitySchemes":{"bearerAuth":{"type":"http","name":"Authorization","scheme":"bearer","bearerFormat":"JWT"}}}}